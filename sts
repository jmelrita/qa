@echo off
setlocal enabledelayedexpansion

set counter=1
set rootDir=D:\JAGSP-LIVE\JAGSP-P-SCAN\J7R

for /d %%A in ("%rootDir%\*") do (
    if exist "%%A\TIF" (
        set "ISBN_NAME=%%~nxA"
        set "STS_FILE=%%A\TIF\!ISBN_NAME!.sts"

        echo Checking for "!STS_FILE!"...

        if exist "!STS_FILE!" (
            set "RENAMED_FILE=%%A\TIF\!ISBN_NAME!_OLD.sts"
            ren "!STS_FILE!" "!RENAMED_FILE!"
            echo Renamed existing file to "!RENAMED_FILE!"
        )

        :: *** WRITE EXACTLY ONE LINE, NO SPACE, NO EXTRA LINE ***
        > "!STS_FILE!" <nul set /p "=BackendReady!counter!"

        echo Created "!STS_FILE!" with BackendReady!counter!

        set /a counter+=1
        if !counter! gtr 5 set counter=1
    ) else (
        echo TIF folder does not exist in %%A. Skipping.
    )
)

echo Done.
pause
